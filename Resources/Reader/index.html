<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Title - My 3D Comic - Chapter 1 - Beginning</title>

		<meta name="author" content="3D Comic Creator Extraordaire">
		<meta name="description" content="New 3D Comic - Chapter 1 - Beginning">
		<meta name="keywords" content="3DComic, 3D Comic, Webtoon, Webcomic, Digital Comic, Spiraloid, Online Graphic Novel, Graphic Novel, 3D Art, 3D model, Concept Art, Digital Painting, VFX">

		<meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1">
		<meta name="apple-mobile-web-app-capable" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1, minimal-ui">

		<link href="./apple-touch-icon.png" rel="apple-touch-icon">
		<link rel="manifest" href="./manifest.json">

		<link href="https://3dcomic.shop/inkbots/SiteThumbnail.jpg" rel="image_src">
		<link href="./favicon.ico" rel="fav-icon">

		<meta content="text/html; charset=utf-8" http-equiv="Content-Type">

		<link href="./styles.css" rel="stylesheet">
		<script src="js/reload.js"></script>
		<script src="js/random_cover.js" type="text/javascript"> </script>
		<script src="js/three.js"></script>
		<script src="js/gltfloader.js"></script>
		<script src="files.js"></script>

		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Audiowide">
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Courier Prime">


	</head>
	<body class="body">


		
		<div class="loadingScreen" id="loadingscreen" style=display:block >
			<div><img alt="" src="./images/loading_screen.gif" style="max-width:100%; height:auto; display: block; position: absolute; margin-right: -50%; top: 30%; left: 50%; transform: translate(-50%, -50%)"  href=""  ></div>
			<div>
				<span class="loadingspinner"><span class="loadingspinner-inner"></span></span>
			</div>
			<!-- <div><img alt="By Bay Raitt" src="./images/singature.gif" style="max-width:100%; height:auto; display: block; position: absolute;  top: 80%;  margin-right: -50%; margin-left: 50%; transform: translate(-65%, -80%)"  href="https://gumroad.com/l/3dcomictoolkit"></div> -->

			
		</div>


		<canvas id="canvas"></canvas>
			<!-- the main container is openned. -->
			<div style="width:100%; max-width:690px; margin-right:auto; margin-left:auto; margin-top:0px; margin-bottom:0px; text-align:center; position:relative">


					<!-- The Home-Button -->
					<div style="width:100%">
							<a class="menuelink" href="https://3dcomic.shop/store/index.html">
									<!-- <div id="homebutton">◄Home</div> -->
									<img  id="homebutton" src="./images/home_button.png" alt="" width="100%" style="display: block;">

							</a>
					</div>

					<!-- The Bonus Badge -->
					<div style="width:100%">
						<a class="bonus_badge" >
								<span id="button_counter">99</span>
								<!-- <div id="homebutton">◄Home</div> -->
								<img  id="bonus_badge" src="./images/bonus_badge.png" alt="" width="100%" style="display: block;" href="">
						</a>
					</div>


					<div style="width:100%; max-height:50vh;">

							<div class="scrollArrowLeft-wrapper">
								<span>S</br>C</br>R</br>O</br>L</br>L</span>
									<div class="scrollArrowLeft">
													<!-- <i class="fa fa-chevron-down"></i> -->
												</br>
												</br>
												</br>
												</br>
													<div id="arrowAnimLeft">
															<div class="arrowSliding">
																	<div class="arrow"></div>
															</div>
															<div class="arrowSliding delay1">
																	<div class="arrow"></div>
															</div>
															<div class="arrowSliding delay2">
																	<div class="arrow"></div>
															</div>
															<div class="arrowSliding delay3">
																	<div class="arrow"></div>
															</div>
													</div>
											</a>
									</div>
							</div>

							<div class="scrollArrowRight-wrapper">
								<span>S</br>C</br>R</br>O</br>L</br>L</span>
									<div class="scrollArrowRight">
													<!-- <i class="fa fa-chevron-down"></i> -->
												</br>
												</br>
												</br>
												</br>
													<div id="arrowAnimRight">
															<div class="arrowSliding">
																	<div class="arrow"></div>
															</div>
															<div class="arrowSliding delay1">
																	<div class="arrow"></div>
															</div>
															<div class="arrowSliding delay2">
																	<div class="arrow"></div>
															</div>
															<div class="arrowSliding delay3">
																	<div class="arrow"></div>
															</div>
													</div>
											</a>
									</div>
							</div>
					</div>


					<!-- The WIP-Chapteer Box -->
					<div id="wipchapterboxbackground">
							<div id="wipchapterbox">
									<div style="width:95%">
										<center>
											<!-- <img src="./images/thow_lo.gif" alt="" style="max-width:100%; height:auto; display: block; position: absolute; margin-right: -50%; top: 20%; left: 50%; transform: translate(-50%, -50%)"  href=""  > -->
											<font style="font-size:1.35em;color:rgb(0, 0, 0);font-family:'Courier Prime';">
												<b>You've arrived at the latest installment of Inkbots!</b>
											</font>

											<font style="color:rgb(0, 0, 0);font-family:'Courier Prime';">
												<br>
												<br>
												Scroll to read, click-and-drag on a panel to move the camera and find hidden
												<font style="color:rgb(238, 255, 0);font-family:'Audiowide'; ">
													<b>BONUSES!</b>
												</font>
												<br>
												<br>
					
												<div><img alt="" height="50vmax"  width="50vmax" src="./images/bonus_badge_complete.png" style="display: block;"  href=""  ></div>
												<br>
												This chapter is
												<font style="color:rgb(255, 255, 255);font-family:'Courier Prime';">
													<b>in progress</b>
												</font>

												<font style="color:rgb(0, 0, 0);font-family:'Courier Prime';">
													and
												</font>

												<font style="color:rgb(255, 255, 255);font-family:'Courier Prime';">
													<b>updates often!</b>
												</font>
												<br>
												<br>
												If you are a returning reader, this button will jump to the latest content:
											</center>
												<br>
											</font>

										</div>
									<!-- The Jump to Bottom-Button -->
									<div style="width:100%; height:32px; margin-left:auto; margin-right:auto; text-align:center; position:relative ">
											<a href="https://3dcomic.shop/inkbots/s01e01/#bottom">
													▼<b>Jump To Bottom</b>▼
											</a>
									</div>
									<!-- <div style="width:100%">
											<br>
											<font style="color:rgb(0, 0, 0);font-family:'Courier Prime'; ">
												If you plan to check this page for updates regularly,
												bookmark so it always sends you to the bottom of the page!
											</font>
									</div> -->

									<!-- <div style="width:100%; text-align:center; margin-top:16px; line-height: 10pt; font-size:1.875em; text-decoration: none">
											<a href="https://3dcomic.shop/inkbots/s01e01/#bottom">
													<center>
														<br>
														<font style="font-size:1.875em;color:chartreuse;font-family:Audiowide;">
														<p><b></b> SAVE BOOKMARK </b></p>
														</font>
														<br>
													</center>
											</a>
									</div> -->
							</div>
					</div>

					<div class="coverwrapper">
							<div  style="width:100%; height:100%"><img id="banner" alt="" class="lazy" height="100%" src="./images/cover_black.gif" style="display: block;" width="100%"></div>
							<div id="coveroverlay"><img alt="" class="lazy" height="100%" src="./images/page_curl_hint.gif" style="display: block;" width="100%"></div>
					</div>

		</div>




		<div id="awardCertificate" class="modal">

			<!-- Modal content -->
			<div class="modal-content">
				<span class="close">&times;</span>
				<center>
					<font style="font-size:1.25em;color:rgb(0, 0, 0);font-family:'Courier Prime';">
						<b>Congratulations!</b>
					</font>
					<font style="font-size:1.25em;color:rgb(0, 0, 0);font-family:'Courier Prime';">
						<br>
						<br>
						Collect prize 
						<div style="width:100%; height:32px; margin-left:auto; margin-right:auto; text-align:center; ">
							<a href="https://gum.co/inkbots_bonus_panel_prize">
								&#187 <b>HERE</b> &#171;
							</a>
						</div>
						<br>
						and enter discount code: 
						<br>
						<br>
						<font style="font-size:1.25em;color:rgb(185, 255, 200);font-family:'Courier Prime'; ">
							<b>"42"</b>
						</font>
						<br>
						<br>
					</font>
				</center>

			</div>
		</div>

		<script>
			// Get the modal
			var modal = document.getElementById("awardCertificate");

			// Get the <span> element that closes the modal
			var span = document.getElementsByClassName("close")[0];
		
			// When the user clicks on <span> (x), close the modal
			span.onclick = function() {
				modal.style.display = "none";
			}
			
			// When the user clicks anywhere outside of the modal, close it
			window.onclick = function(event) {
				if (event.target == modal) {
				modal.style.display = "none";
				}
			}
		</script>

		<div id="content"></div>


		<script>
			document.cookie = 'name=3dcomicshop; ; SameSite=Secure;'

			var canvas = document.getElementById( 'canvas' );
			var content = document.getElementById( 'content' );
			var isPlayingSound = false;
			var camera, scene, renderer, frustum;
			var scenes = [];
			var hasClicked = false;
			var panelCount;

			var isPointerDown = false;
			var pointer = new THREE.Vector2();
			var pointerOnDown = new THREE.Vector2();
			var raycaster = new THREE.Raycaster ();
			var isDragging = false;
			var uncollectedBonuses = 0;
			const bonusSoundEffect = new Audio();
			
			var language = 'en';

			var isMobile = {
				Android: function() {
					return navigator.userAgent.match(/Android/i);
				},
				BlackBerry: function() {
					return navigator.userAgent.match(/BlackBerry/i);
				},
				iOS: function() {
					return navigator.userAgent.match(/iPhone|iPad|iPod/i);
				},
				Opera: function() {
					return navigator.userAgent.match(/Opera Mini/i);
				},
				Windows: function() {
					return navigator.userAgent.match(/IEMobile/i);
				},
				any: function() {
					return (isMobile.Android() || isMobile.BlackBerry() || isMobile.iOS() || isMobile.Opera() || isMobile.Windows());
				}
			};

			// store the users scrolling location 
			const progress = localStorage.getItem('progress');
			window.addEventListener("scroll", (event) => {
				let scroll = this.scrollY;
				// console.log(scroll)
				localStorage.setItem('progress', scroll);
			});


			var cameraSpeedScaler = 1;
			if(isMobile.any()) {
				cameraSpeedScaler = 0.125
			} else {
				cameraSpeedScaler = 0.05
			}




			if ( window.location.search.substr( 0, 5 ) === '?lan=' ) {

				language = window.location.search.substr( 5 );

			}


			init();
			loadFiles();
			animate();

			function init() {

				renderer = new THREE.WebGLRenderer( { canvas: canvas, antialias: true } );
				renderer.setClearColor( 0x131313 );
				renderer.setPixelRatio( window.devicePixelRatio );
				renderer.shadowMap.enabled = true;
				renderer.shadowMap.type = THREE.BasicShadowMap;
				renderer.outputEncoding = THREE.sRGBEncoding;

				pickingTextureOcclusion = new THREE.WebGLRenderTarget(window.innerWidth / 2, window.innerHeight / 2);

				document.body.addEventListener( 'pointerdown', onPointerDown );
				document.body.addEventListener( 'pointerdown', onPointerDown );
				document.body.addEventListener( 'pointermove', onPointerMove );
				document.body.addEventListener( 'pointerout', onPointerUp );
				document.body.addEventListener( 'pointerup', onPointerUp );

			}

			function onPointerDown( event ) {
				if (!hasClicked){
					bonusSoundEffect.play();
					bonusSoundEffect.pause();
					bonusSoundEffect.currentTime = 0;
					hasClicked = true
				}

				isPointerDown = true;
				pointerOnDown.x = event.clientX;
				pointerOnDown.y = event.clientY;
				pointer.x = event.clientX;
				pointer.y = event.clientY;


			}

			function onPointerMove( event ) {

				pointer.x = event.clientX;
				pointer.y = event.clientY;

			}

			function onPointerUp() {

				isPointerDown = false;
				isDragging = false;

			}

			// var delay = ( function() {
			// 	var timer = 0;
			// 	return function(callback, ms) {
			// 		clearTimeout (timer);
			// 		timer = setTimeout(callback, ms);
			// 	};
			// })();


			function getScreenPos(object, camera) {
				var pos = object.position.clone();
				camera.updateMatrixWorld();
				pos.project(camera);
				return new THREE.Vector2(pos.x, pos.y);
			}

			function awardBonus(object, camera) {
				if (uncollectedBonuses > 0 )
				{
					bonusSoundEffect.src ='./bonus_achievement.mp3';
					uncollectedBonuses -= 1
					document.getElementById("button_counter").innerHTML = uncollectedBonuses;

				}
				if (uncollectedBonuses == 0 )
				{
					bonusSoundEffect.src ='./bonus_achievement_all.mp3';
					document.getElementById("button_counter").style.visibility = "hidden";
					document.getElementById("bonus_badge").src="./images/bonus_badge_complete.png";
					document.getElementById("awardCertificate").style.display = "block";

				}

				bonusSoundEffect.loop = false;
				bonusSoundEffect.play();
				// var ts = calc_texture_size(size + size * 2 * margin) * 2;
				// var img = new Image();
				// var texture = new THREE.Texture(bonus_canvas);
				// bonus_canvas.width = bonus_canvas.height = ts;
				// context.fillStyle = back_color;
				// context.fillRect(0, 0, bonus_canvas.width, bonus_canvas.height);
				// var boonusLocation = getScreenPos(object, camera);
				// img.addEventListener('load', function(){
				// 	bonus_canvas.drawImage(img, boonusLocation[0], boonusLocation[1]);
				// 	texture.needsUpdate = true;
				// });
				// img.src = './images/bonus_pop.png';

			}


			function isOccludedBuffer(object, scene, camera, rendererm, width, height) {
				renderer.setRenderTarget(pickingTextureOcclusion);
				renderer.render(scene, camera);
				var pixelBuffer  = new Uint8Array(width * height);
				renderer.readRenderTargetPixels(pickingTextureOcclusion, 0, 0, width / 2, height / 2, pixelBuffer);
				renderer.setRenderTarget(null);
				if (pixelBuffer.includes(object.name)){
					return true;
					console.log(object.name + " is visible !!");
				} else {
					return false;
					console.log(object.name + " is not visible !!");
				}
			}

			// function isOccluded(object, scene, camera) {
			// 	raycaster.setFromCamera(getScreenPos(object, camera), camera);
			// 	var intersects = raycaster.intersectObjects(scene.children);
			// 	if (intersects[0] && intersects[0].object === object) {
			// 		return false;
			// 		console.log(object.name + " is not occluded !!");

			// 	} else {
			// 		return true;
			// 		console.log(object.name + " is occluded !!");

			// 	}
			// }

			function inFrustum(object, frustum, camera) {
				frustum.setFromProjectionMatrix(new THREE.Matrix4().multiplyMatrices(camera.projectionMatrix, camera.matrixWorldInverse));
				return frustum.intersectsObject(object);
			}

			function normalize(val, max, min) { 
				return (val - min) / (max - min); 
			}

			function loadFiles() {

				var loader = new THREE.GLTFLoader();
				panelCount = files.length;

				for ( var i = 0; i < files.length; i ++ ) {

					loadFile( files[ i ].replace( '${lan}', language ) );
				}


				async function importRef(scene, glb_file) {
					var ref_data = loader.load( glb_file, function ( gltf ) {
						scene.add( gltf.scene );
					}) 
					return { ref_data };
				}


				var loadedPanelCount = 0;
				function loadFile( path ) {

					var aspect = 1;

					var width = 100;
					var height = 100;

					var parts = path.split( '.' );
					var regex = /^w([0-9]+)h([0-9]+)/;
					var result = regex.exec( parts[ parts.length - 3 ] );

					if ( result !== null ) {

						width = result[ 1 ];
						height = result[ 2 ];

					}

					var element = document.createElement( 'div' );
					element.className = 'panel';
					element.style.display = 'inline-block';
					element.style.width = width + '%';
					// Hack: Maintain aspect ratio in divs
					// https://css-tricks.com/aspect-ratio-boxes/
					element.style.height = '0';
					element.style.paddingTop = ( height / aspect ) + '%';
					content.appendChild( element );

					var colors = new Uint8Array( [ 0, 0, 255 ] );
					var gradientMap = new THREE.DataTexture( colors, 3, 1, THREE.LuminanceFormat );
					gradientMap.minFilter = THREE.NearestFilter;
					gradientMap.magFilter = THREE.NearestFilter;
					gradientMap.generateMipmaps = false;

					loader.load( path, function ( gltf ) {

						var scene = gltf.scene;

						var camera, cameraOrigin, cameraTarget, cameraTargetDistance, bonusGemstone, frustum, cameraOrbitSpeed;
						var letters, ref_object, ref_glb_file;

						var isBonusFound = false;

						scene.traverse( function ( child ) {

							if ( /^Camera\d{4}$/.test( child.name ) ) cameraOrigin = child;
							if ( /^Camera_aim\d{4}$/.test( child.name ) ) cameraTarget = child;
							if ( /^Letters_\w+\d{4}$/.test( child.name ) ) letters = child;
							if ( /^Bonus_\d{4}$/.test( child.name ) ) bonusGemstone = child;
							if ( /^ref_/.test( child.name ) ) ref_object = child;

							//

							if ( child.isPerspectiveCamera ) {

								camera = child.clone();
								camera.userData.vFov = camera.fov;
								camera.userData.far = camera.far;

							}

							if ( child.isLight ) {

								child.castShadow = true;
								child.shadow.mapSize.set( 1024, 1024 );
								child.shadow.autoUpdate = false;
								child.shadow.needsUpdate = true;
								child.shadow.camera.near = 1;
								child.shadow.camera.far = 20;
								child.shadow.bias = 0.00005;

							}

							if ( child.isMesh && child.material.isMeshStandardMaterial ) {

								child.castShadow = true;
								child.receiveShadow = true;

								var color = child.material.color;

								child.material = new THREE.MeshToonMaterial( {
									color: color,
									gradientMap: gradientMap
								} );

							}

							if ( child.isMesh && child.material.isMeshBasicMaterial ) {

								child.castShadow = false;
								child.receiveShadow = false;

								var color = child.material.color;
							}
						} );

						var mixer = new THREE.AnimationMixer( scene );
						gltf.animations.forEach( function ( clip ) {

							mixer.clipAction( clip ).play();
							scene.userData.duration = clip.duration;

						} );

						//

						if ( camera ) {

							scene.add( camera );

							if ( cameraOrigin ) {

								camera.position.copy( cameraOrigin.position );
								camera.rotation.copy( cameraOrigin.rotation );
							}

							if ( letters ) {

								letters.position.set( 0, 0, - 2 );
								letters.rotation.set( 0, 0, 0 );

								camera.add( letters );

							}
							
						}



						if ( ref_object ) {
							ref_glb_file = "./panels/" + ref_object.userData.ref_filename;
							console.log(ref_glb_file);
							importRef(scene, ref_glb_file)
						}


						scene.userData.activePanel = false;
						scene.userData.camera = camera;
						scene.userData.cameraOrigin = cameraOrigin;
						scene.userData.cameraTarget = cameraTarget;
						cameraTargetDistance =  cameraOrigin.position.distanceTo(cameraTarget.position);
						cameraFovNormalized = normalize(camera.userData.vFov, 90, 0)
						cameraDistanceNormalized = normalize(cameraTargetDistance, 0, 1)
						cameraOrbitSpeed = cameraFovNormalized / cameraDistanceNormalized
						// cameraOrbitSpeed = camera.userData.vFov / cameraTargetDistance
						scene.userData.cameraOrbitSpeed =  Math.abs(cameraOrbitSpeed  *  (1 + cameraDistanceNormalized) * cameraSpeedScaler);						
						// console.log("cameraOrbitSpeed for " + path + " = " + cameraOrbitSpeed );
						// console.log("camera.userData.vFov for " + path + " = " + camera.userData.vFov );


						if ( bonusGemstone ) {
							scene.userData.bonusGemstone = bonusGemstone;
							var frustum = new THREE.Frustum();
							scene.userData.frustum = frustum;
							scene.userData.isBonusFound = isBonusFound;
							uncollectedBonuses += 1
						}

						scene.userData.element = element;
						scene.userData.mixer = mixer;

						scenes.push( scene );

						loadedPanelCount++;


						if (loadedPanelCount === panelCount){
							console.log("LOAD COMPLETE")

							// hide load screen
							document.getElementById("loadingscreen").style.display = "none";

							// enable scrolling
							document.body.style.overflow = "scroll";


							// scroll to last saved progress point
							window.onload = function(){ window.scrollTo(0,progress); }

						}

					} );

				}

			}

			function updateSize() {

				var width = canvas.clientWidth;
				var height = canvas.clientHeight;
				var dpr = window.devicePixelRatio;

				if ( canvas.width !== width * dpr || canvas.height !== height * dpr ) {

					renderer.setSize( width, height, false );

				}
				document.getElementById("button_counter").innerHTML = uncollectedBonuses;
				if (uncollectedBonuses != 0){
					document.getElementById("button_counter").style.visibility = "visible";
				}

			}

			function animate() {
				requestAnimationFrame( animate );

				render();

			}

			var clock = new THREE.Clock();
			var speed = -2; //units a second
			var delta = 0;


			function render() {

				updateSize();

				// canvas.style.transform = `translateY(${window.scrollY}px)`;

				renderer.setScissorTest( false );
				renderer.clear();

				renderer.setScissorTest( true );

				scenes.forEach( function ( scene ) {

					var element = scene.userData.element;
					var rect = element.getBoundingClientRect();

					if ( rect.bottom < 0 || rect.top > renderer.domElement.clientHeight ||
							rect.right < 0 || rect.left > renderer.domElement.clientWidth ) {

						return; // it's off screen

					}

					var width = rect.right - rect.left;
					var height = rect.bottom - rect.top;
					var left = rect.left;
					var bottom = renderer.domElement.clientHeight - rect.bottom;

					renderer.setViewport( left, bottom, width, height );
					renderer.setScissor( left, bottom, width, height );

					var camera = scene.userData.camera;
					camera.aspect = rect.width / rect.height;
					camera.fov = camera.userData.vFov;
					camera.far = camera.userData.far;

					if ( camera.aspect < 1 ) {
						// Use horizontal fov in vertical aspect ratios
						camera.fov = Math.atan( Math.tan( camera.fov * Math.PI / 360 ) / camera.aspect ) * 360 / Math.PI;
					}

					camera.updateProjectionMatrix();

					var time = THREE.Math.mapLinear( rect.top, renderer.domElement.clientHeight, - rect.height, 0, 1 );
					var duration = scene.userData.duration;

					var mixer = scene.userData.mixer;
					mixer.setTime( time * duration );
					delta = 0; // for bonus collection

					//

					var isPointerInFrameX = pointer.x < rect.right && pointer.x > rect.left;
					var isPointerInFrameY = pointer.y < rect.bottom && pointer.y > rect.top;
					var isPointerInFrame;

					if (isPointerInFrameX && isPointerInFrameY){
						isPointerInFrame = true;
					}
					else {
						isPointerInFrame = false;
					}

					var cameraOrigin = scene.userData.cameraOrigin;
					var cameraTarget = scene.userData.cameraTarget;
					var cameraTargetDistance = scene.userData.cameraTargetDistance;
					var bonusGemstone = scene.userData.bonusGemstone;
					var frustum = scene.userData.frustum;
					var isBonusFound = scene.userData.isBonusFound;
					var cameraOrbitSpeed = scene.userData.cameraOrbitSpeed

					if ( cameraOrigin ) {

						// if ( isPointerDown && isPointerInFrame) { 

						// 	// cameraTargetDistanceScaler =  cameraOrbitSpeed * 0.015 * (cameraOrbitSpeed * 0.015);
						// 	camera.position.x = cameraOrigin.position.x - ( ( pointer.x - pointerOnDown.x ) * cameraOrbitSpeed );
						// 	camera.position.y = cameraOrigin.position.y + ( ( pointer.y - pointerOnDown.y ) * cameraOrbitSpeed );
						// 	camera.position.z = cameraOrigin.position.z;

						// 	// console.log("pointer.x = " + pointer.x );

						// 	scene.userData.activePanel = true;

						if ( isPointerInFrame && isPointerDown && !isDragging) { 
							isDragging = true;
							scene.userData.activePanel = true;
						}

						if ( isPointerDown  && scene.userData.activePanel ) { 
							var num = cameraOrigin.position.y + ( ( pointer.y - pointerOnDown.y ) * cameraOrbitSpeed * .4 );

							var number = Math.min(Math.max(parseFloat(num), 0.125), 200);

							camera.position.x = cameraOrigin.position.x - ( ( pointer.x - pointerOnDown.x ) * cameraOrbitSpeed );
							camera.position.y = number;
							camera.position.z = cameraOrigin.position.z;
						} else {

							camera.position.x += ( cameraOrigin.position.x - camera.position.x ) * 0.11;
							camera.position.y += ( cameraOrigin.position.y - camera.position.y ) * 0.12;
							camera.position.z += ( cameraOrigin.position.z - camera.position.z ) * 0.13;	
						}

						if (scene.userData.activePanel){
							if ( !isPointerDown ) { 
								if ( bonusGemstone ) {
								// if (isOccluded(bonusGemstone, scene, camera)) {
									if ( !isBonusFound) {
										if (inFrustum(bonusGemstone, frustum, camera)) {
											if (!isOccludedBuffer(bonusGemstone, scene, camera, renderer, width, height)) {
												clock.stop();
												clock.start();
												var executed = false;
												scene.userData.isBonusFound = true;
												if (!executed) {
													awardBonus(bonusGemstone, camera);
													executed = true;
													console.log("Bonus " + bonusGemstone.name + " Collected!!");
													console.log( uncollectedBonuses + " Bonuses Left!");
													var vanishScale = 0.0001
													bonusGemstone.scale.x = vanishScale;
													bonusGemstone.scale.y = vanishScale;
													bonusGemstone.scale.z = vanishScale;
												}
											}
										}
									}
								}
								
								// if (isBonusFound){
									// vanishScale = 0.0001
									// delta = clock.getDelta();
									// if (bonusGemstone.scale.x > vanishScale) {
									// 	bonusGemstone.scale.x += speed * delta ;
									// 	bonusGemstone.scale.y += speed * delta ;
									// 	bonusGemstone.scale.z += speed * delta ;
									// }
									// else{
									// 	bonusGemstone.scale.x = vanishScale;
									// 	bonusGemstone.scale.y = vanishScale;
									// 	bonusGemstone.scale.z = vanishScale;
									// }
									// console.log("Clock: " + bonusGemstone.scale.x);
								// }
								
							}
						}
						
						if ( !isPointerDown) { 
							scene.userData.activePanel = false;
						}

					}

					if ( cameraTarget ) {

						camera.lookAt( cameraTarget.position );

					}
					if ( isPointerDown ) { 
						if ( bonusGemstone ) {
							bonusGemstone.lookAt( camera.position );
						}
					}



					renderer.render( scene, camera );

				} );


			}
		</script>
		<a name="bottom"></a>
		<div class="footer" style="width:100%; max-width:690px; margin-right:auto; margin-left:auto; margin-top:0px; margin-bottom:0px; text-align:center; position:relative">
			<span>
				<iframe src="https://3dcomic.shop/dev/footer/footer.html" width="100%" frameborder="0" scrolling="no" onload="this.height = this.offsetWidth"></iframe>
			</span>
		</div>


	</body>
</html>
